#!/bin/bash -ex

main() {
  install_dependencies
  run_unit_tests
  run_system_tests_individually_to_isolate_state
}

install_dependencies() {
  bundle install
}

run_unit_tests() {
  bundle exec rake spec:unit
}


run_system_tests_individually_to_isolate_state() {
  spec_files=($(find spec/system/ -type f))

  for spec_file in "${spec_files[@]}"
  do
    bundle exec rspec "$spec_file" --fail-fast
  done
}

main
